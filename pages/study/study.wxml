<view class="container">
  <navigation-bar title="背单词" back="{{false}}" color="white" background="rgba(0,0,0,0.3)"></navigation-bar>
  
  <view class="content">
    <scroll-view class="page-scrollable" scroll-y="true" enable-back-to-top="true">
    <!-- 主页面内容 -->
    <view wx:if="{{!isStudying && !completed}}">
      <!-- 学习统计概览 -->
      <view class="stats-overview-wrapper">
        <view class="stats-overview">
        <view class="stat-card">
          <view class="stat-value">{{totalWords}}</view>
          <view class="stat-desc">总单词数</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{masteredWords}}</view>
          <view class="stat-desc">已掌握</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{unstudiedWords}}</view>
          <view class="stat-desc">未学习</view>
        </view>
        </view>
      </view>

      <!-- 功能入口网格 -->
      <view class="features-grid">
        <view class="feature-card" bindtap="goToCamera">
          <view class="feature-icon">📷</view>
          <view class="feature-title">拍照识词</view>
          <view class="feature-desc">拍照识别单词并加入词库</view>
        </view>
        
        <view class="feature-card" bindtap="goToWordList">
          <view class="feature-icon">📚</view>
          <view class="feature-title">词库管理</view>
          <view class="feature-desc">管理单词和词库</view>
        </view>
        
        <view class="feature-card" bindtap="showResetProgress">
          <view class="feature-icon">🔄</view>
          <view class="feature-title">重置进度</view>
          <view class="feature-desc">重置所有单词的学习进度</view>
        </view>
        
        <view class="feature-card" bindtap="startStudy">
          <view class="feature-icon">🎯</view>
          <view class="feature-title">开始学习</view>
          <view class="feature-desc">开始背诵单词</view>
        </view>
      </view>

      <!-- 学习设置 -->
      <view class="settings-section">
        <view class="section-title">学习设置</view>
        
        <view class="setting-item">
          <view class="setting-left">
            <view class="setting-label">学习模式</view>
            <view class="setting-desc">选择要学习的单词范围</view>
          </view>
          <view class="setting-options">
            <view 
              class="option {{studyMode === 'all' ? 'active' : ''}}"
              bindtap="setStudyMode"
              data-mode="all"
            >
              全部单词
            </view>
            <view 
              class="option {{studyMode === 'unstudied' ? 'active' : ''}}"
              bindtap="setStudyMode"
              data-mode="unstudied"
            >
              未学习
            </view>
          </view>
        </view>
        
        <view class="setting-item">
          <view class="setting-left">
            <view class="setting-label">随机排序</view>
            <view class="setting-desc">打乱单词顺序</view>
          </view>
          <switch 
            checked="{{randomOrder}}" 
            bindtap="toggleRandomOrder"
          ></switch>
        </view>
      </view>
    </view>

    <!-- 学习页面 -->
    <view wx:if="{{isStudying || completed}}">
      <!-- 进度条 -->
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progress}}%"></view>
        <text class="progress-text">{{currentIndex + 1}} / {{totalWords}}</text>
      </view>

      <!-- 单词卡片 -->
      <view class="word-card {{showTranslation ? 'flipped' : ''}}" wx:if="{{currentWord && !completed}}">
        <view class="card-front" bindtap="flipCard">
          <view class="word-text">{{currentWord.text}}</view>
          <view class="hint-text">点击查看释义</view>
        </view>
        
        <view class="card-back" bindtap="flipCard">
          <view class="word-text">{{currentWord.text}}</view>
          <view class="translation-text">{{currentWord.translation}}</view>
          <view class="hint-text">点击隐藏释义</view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-buttons" wx:if="{{currentWord && showTranslation && !completed}}">
        <button class="btn-difficult" bindtap="markDifficult">
          😰 不认识
        </button>
        <button class="btn-easy" bindtap="markEasy">
          😊 认识
        </button>
      </view>

      <!-- 学习完成 -->
      <view class="completion" wx:if="{{completed}}">
        <view class="completion-icon">🎉</view>
        <view class="completion-title">学习完成！</view>
        <view class="completion-stats">
          <view class="stat-item">
            <text class="stat-number">{{totalWords}}</text>
            <text class="stat-label">总单词</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{correctCount}}</text>
            <text class="stat-label">认识</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{wrongCount}}</text>
            <text class="stat-label">不认识</text>
          </view>
        </view>
        
        <view class="completion-actions">
          <button class="btn-secondary" bindtap="reviewWrong" wx:if="{{wrongCount > 0}}">
            复习错词
          </button>
          <button class="btn-primary" bindtap="restartStudy">
            重新开始
          </button>
          <button class="btn-secondary" bindtap="backToHome">
            返回主页
          </button>
        </view>
      </view>

      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{!currentWord && !completed && isStudying}}">
        <view class="empty-icon">📚</view>
        <text class="empty-text">暂无单词可学习</text>
        <button class="btn-primary" bindtap="goToCamera">去拍照识词</button>
      </view>

      <!-- 设置按钮 -->
      <view class="settings-btn" bindtap="showSettingsPanel" wx:if="{{!completed}}">
        ⚙️
      </view>
    </view>
    </scroll-view>
  </view>

  <!-- 重置进度确认弹窗 -->
  <view class="modal {{showResetModal ? 'show' : ''}}">
    <view class="modal-content">
      <view class="modal-title">确认重置进度</view>
      <view class="modal-message">
        此操作将重置所有单词的学习进度，确定要继续吗？
      </view>
      <view class="modal-actions">
        <button class="btn-secondary" bindtap="cancelReset">取消</button>
        <button class="btn-primary" bindtap="confirmReset">确定</button>
      </view>
    </view>
  </view>
</view>